import json

from bs4 import BeautifulSoup


def from_soup_get_page(soup):
    s = soup.contents[-1].replace("\",", "{").replace(";", "").replace("records", "\"records\"") \
        .replace("pages", "\"pages\"").replace("curpage", "\"curpage\"").strip()
    s = json.loads(s)["pages"]
    return s


if __name__ == '__main__':
    html = """
    var apidata={ content:"<table class='w782 comm lsjz'><thead><tr><th class='first'>净值日期</th><th>单位净值</th><th>累计净值</th><th>日增长率</th><th>申购状态</th><th>赎回状态</th><th class='tor last'>分红送配</th></tr></thead><tbody><tr><td>2021-08-31</td><td class='tor bold'>1.0568</td><td class='tor bold'>1.0568</td><td class='tor bold red'>1.43%</td><td>开放申购</td><td>开放赎回</td><td class='red unbold'></td></tr><tr><td>2021-08-30</td><td class='tor bold'>1.0419</td><td class='tor bold'>1.0419</td><td class='tor bold grn'>-1.74%</td><td>开放申购</td><td>开放赎回</td><td class='red unbold'></td></tr><tr><td>2021-08-27</td><td class='tor bold'>1.0604</td><td class='tor bold'>1.0604</td><td class='tor bold red'>0.32%</td><td>开放申购</td><td>开放赎回</td><td class='red unbold'></td></tr><tr><td>2021-08-26</td><td class='tor bold'>1.0570</td><td class='tor bold'>1.0570</td><td class='tor bold grn'>-1.46%</td><td>开放申购</td><td>开放赎回</td><td class='red unbold'></td></tr><tr><td>2021-08-25</td><td class='tor bold'>1.0727</td><td class='tor bold'>1.0727</td><td class='tor bold grn'>-0.98%</td><td>开放申购</td><td>开放赎回</td><td class='red unbold'></td></tr><tr><td>2021-08-24</td><td class='tor bold'>1.0833</td><td class='tor bold'>1.0833</td><td class='tor bold red'>0.75%</td><td>开放申购</td><td>开放赎回</td><td class='red unbold'></td></tr><tr><td>2021-08-23</td><td class='tor bold'>1.0752</td><td class='tor bold'>1.0752</td><td class='tor bold red'>0.09%</td><td>开放申购</td><td>开放赎回</td><td class='red unbold'></td></tr><tr><td>2021-08-20</td><td class='tor bold'>1.0742</td><td class='tor bold'>1.0742</td><td class='tor bold grn'>-0.46%</td><td>开放申购</td><td>开放赎回</td><td class='red unbold'></td></tr><tr><td>2021-08-19</td><td class='tor bold'>1.0792</td><td class='tor bold'>1.0792</td><td class='tor bold grn'>-2.01%</td><td>开放申购</td><td>开放赎回</td><td class='red unbold'></td></tr><tr><td>2021-08-18</td><td class='tor bold'>1.1013</td><td class='tor bold'>1.1013</td><td class='tor bold red'>3.97%</td><td>开放申购</td><td>开放赎回</td><td class='red unbold'></td></tr><tr><td>2021-08-17</td><td class='tor bold'>1.0592</td><td class='tor bold'>1.0592</td><td class='tor bold grn'>-0.74%</td><td>开放申购</td><td>开放赎回</td><td class='red unbold'></td></tr><tr><td>2021-08-16</td><td class='tor bold'>1.0671</td><td class='tor bold'>1.0671</td><td class='tor bold red'>0.48%</td><td>开放申购</td><td>开放赎回</td><td class='red unbold'></td></tr><tr><td>2021-08-13</td><td class='tor bold'>1.0620</td><td class='tor bold'>1.0620</td><td class='tor bold grn'>-0.04%</td><td>开放申购</td><td>开放赎回</td><td class='red unbold'></td></tr><tr><td>2021-08-12</td><td class='tor bold'>1.0624</td><td class='tor bold'>1.0624</td><td class='tor bold grn'>-0.72%</td><td>开放申购</td><td>开放赎回</td><td class='red unbold'></td></tr><tr><td>2021-08-11</td><td class='tor bold'>1.0701</td><td class='tor bold'>1.0701</td><td class='tor bold red'>0.57%</td><td>开放申购</td><td>开放赎回</td><td class='red unbold'></td></tr><tr><td>2021-08-10</td><td class='tor bold'>1.0640</td><td class='tor bold'>1.0640</td><td class='tor bold red'>1.33%</td><td>开放申购</td><td>开放赎回</td><td class='red unbold'></td></tr><tr><td>2021-08-09</td><td class='tor bold'>1.0500</td><td class='tor bold'>1.0500</td><td class='tor bold red'>2.45%</td><td>开放申购</td><td>开放赎回</td><td class='red unbold'></td></tr><tr><td>2021-08-06</td><td class='tor bold'>1.0249</td><td class='tor bold'>1.0249</td><td class='tor bold red'>0.18%</td><td>开放申购</td><td>开放赎回</td><td class='red unbold'></td></tr><tr><td>2021-08-05</td><td class='tor bold'>1.0231</td><td class='tor bold'>1.0231</td><td class='tor bold grn'>-0.32%</td><td>开放申购</td><td>开放赎回</td><td class='red unbold'></td></tr><tr><td>2021-08-04</td><td class='tor bold'>1.0264</td><td class='tor bold'>1.0264</td><td class='tor bold grn'>-0.54%</td><td>开放申购</td><td>开放赎回</td><td class='red unbold'></td></tr></tbody></table>",records:51,pages:3,curpage:1};
    """

    sp = BeautifulSoup(html, 'html.parser')
    print(sp.contents[-1])
    page = from_soup_get_page(sp)
    print(page, type(page))
